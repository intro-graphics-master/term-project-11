<!doctype html> <html lang=en> <head> <meta charset=UTF-8> <meta name=viewport content="width=device-width,initial-scale=1"> <meta http-equiv=X-UA-Compatible content="ie=edge"> <meta name=viewport content="width=device-width,user-scalable=no,minimum-scale=1,maximum-scale=1"> <title>Final_Project</title> <link rel=icon href=src/images/fav.ico> <style>body{margin:0;height:100vh;width:100vh}canvas{display:block}</style> </head> <body> <div id=container></div> <div style=position:fixed;top:0;left:0;cursor:pointer;opacity:.9;z-index:10000></div> <script src=src/three.js></script> <script src=src/OrbitControls.js></script> <script src=src/ImprovedNoise.js></script> <script src=src/noise.js></script> <script src=src/WebGL.js></script> <script src=src/stats.min.js></script> <script src=src/Sky.js></script> <script src=src/Water.js></script> <script src=src/dat.gui.min.js></script> <script>var container,stats,camera,controls,scene,renderer,light,mesh,texture,water,cloud,flash,rainGeo,rainCount=15e3,cloudparticles_w=new THREE.Group,cloudparticles_b=new THREE.Group,worldWidth=window.innerWidth,worldDepth=window.innerHeight,worldHalfWidth=worldWidth/2,worldHalfDepth=worldDepth/2,clock=new THREE.Clock;container=document.getElementById("container"),(scene=new THREE.Scene).background=new THREE.Color(12571109),scene.fog=new THREE.FogExp2(15716789,2e-4),(camera=new THREE.PerspectiveCamera(100,window.innerWidth/window.innerHeight,.01,2e4)).position.set(30,30,100),light=new THREE.DirectionalLight(16777215,.8),scene.add(light),(renderer=new THREE.WebGLRenderer).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),(controls=new THREE.OrbitControls(camera,renderer.domElement)).maxPolarAngle=.495*Math.PI,controls.target.set(0,10,0),controls.minDistance=40,controls.maxDistance=200,controls.update();var gui=new dat.GUI;gui.remember(GuiControl);var GuiControl=new function(){this.blackcloudrange=1,this.cloudsize_b=2,this.cloudopacity_b=.6,this.cloudcolor_b=16777215,this.cloudtransparent_b=!0,this.whitecloudrange=1,this.cloudsize_w=2,this.cloudopacity_w=.6,this.cloudcolor_w=16777215,this.cloudtransparent_w=!0,this.rainrange=1e3,this.rainsize=2,this.rainopacity=.8,this.raincolor=16777215,this.raintransparent=!0,this.rainvertexcolors=!0,this.rainsizeattenuation=!0,this.snowrange=1e3,this.snowsize=2,this.snowopacity=.8,this.snowcolor=16777215,this.snowtransparent=!0,this.snowvertexcolors=!0,this.snowsizeattenuation=!0,this.waterfog=!0,this.windpower_x=0,this.windpower_z=0,this.rotatesystem=!1,this.christmastimebab="src/music/its christmas time bab!.mp3",this.chickentoobeauty="src/music/ChickenTooBeauty.mp3",this.GETHIGHB="src/music/GET HIGH B.flac",this.sound_1v=0,this.sound_2v=0,this.sound_3v=0,this.analyse=!1},listener=new THREE.AudioListener;camera.add(listener);var analyser,mediaElement,folder,cloud_b,cloud_w,rain,snow,audioLoader=new THREE.AudioLoader,sound_1=new THREE.Audio(listener),sound_2=new THREE.Audio(listener),sound_3=new THREE.Audio(listener),fftSize=128;function MUSICTIMEBAB(e,o){audioLoader.load(e,function(e){o.setBuffer(e),o.setLoop(!0),o.setVolume(0)}),analyser=new THREE.AudioAnalyser(o,fftSize),mediaElement=analyser.getAverageFrequency()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),controls.handleResize()}function redraw_ec(){snow&&(scene.remove(snow),Snowinit(GuiControl.snowrange)),rain&&(scene.remove(rain),Raininit(GuiControl.rainrange)),controls.autoRotate=GuiControl.rotatesystem}function redrwa_bc(){scene.remove(cloudparticles_b),Blackcloudinit(GuiControl.blackcloudrange)}function redrwa_wc(){scene.remove(cloudparticles_w),Whitecloudinit(GuiControl.whitecloudrange)}function redraw(){cloud_b&&(cloudparticles_b=[],scene.children.cloud_b={},Blackcloudinit(GuiControl.blackcloudrange)),cloud_w&&(cloudparticles_w=[],scene.children.cloud_w={},Whitecloudinit(GuiControl.whitecloudrange)),snow&&(scene.remove(snow),Snowinit(GuiControl.snowrange)),rain&&(scene.remove(rain),Raininit(GuiControl.rainrange)),controls.autoRotate=GuiControl.rotatesystem}function render(){performance.now();water.material.uniforms.time.value+=1/60,noise.seed(Math.random()),water.geometry.vertices.forEach(function(e){var o=2e-4*noise.simplex3(e.x,e.y,e.z);e.y+=o*mediaElement}),analyser.getFrequencyData(),water.geometry.verticesNeedUpdate=!0,cloudparticles_b.children.forEach(function(e){e.lookAt(camera.position)}),cloudparticles_w.children.forEach(function(e){e.lookAt(camera.position)}),snow.geometry.vertices.forEach(function(e){0<GuiControl.windpower_x&&(e.x+=GuiControl.windpower_x+5*Math.random(),500<=e.x&&(e.x=-500-e.velocityX-5*Math.random()),e.y=e.y-1.5*e.velocityY,e.x=e.x-.5*e.velocityX,e.z=e.z-.5*e.velocityZ),0<GuiControl.windpower_z&&(e.z+=GuiControl.windpower_z+5*Math.random(),500<=e.z&&(e.z=-500-e.velocityZ-5*Math.random()),e.y=e.y-1.5*e.velocityY,e.x=e.x-.5*e.velocityX,e.z=e.z-.5*e.velocityZ),0==GuiControl.windpower_x&&0==GuiControl.windpower_z&&(e.y=e.y-1.5*e.velocityY,e.x=e.x-.5*e.velocityX,e.z=e.z-.5*e.velocityZ),e.y<=-100&&(e.y=500),(e.x<=-500||500<=e.x)&&(e.velocityX=-1*e.velocityX),(e.z<=-500||500<=e.z)&&(e.velocityZ=-1*e.velocityZ)}),snow.geometry.verticesNeedUpdate=!0,rain.geometry.vertices.forEach(function(e){0<GuiControl.windpower_x&&(e.x+=GuiControl.windpower_x+5*Math.random(),500<=e.x&&(e.x=-500-e.velocityX-5*Math.random()),e.y=e.y-30*e.velocityY,e.x=e.x-.5*e.velocityX,e.z=e.z-.5*e.velocityZ),0<GuiControl.windpower_z&&(e.z+=GuiControl.windpower_x+5*Math.random(),500<=e.z&&(e.z=-500-e.velocityZ-5*Math.random()),e.y=e.y-30*e.velocityY,e.x=e.x-.5*e.velocityX,e.z=e.z-.5*e.velocityZ),0==GuiControl.windpower_x&&0==GuiControl.windpower_z&&(e.y=e.y-30*e.velocityY,e.x=e.x-.5*e.velocityX,e.z=e.z-.5*e.velocityZ),e.y<=-100&&(e.y=500),(e.x<=-500||500<=e.x)&&(e.velocityX=-1*e.velocityX),(e.z<=-500||500<=e.z)&&(e.velocityZ=-1*e.velocityZ)}),rain.geometry.verticesNeedUpdate=!0}function animate(){requestAnimationFrame(animate),render(),stats.update(),controls.update(clock.getDelta()),renderer.render(scene,camera)}function Terraininit(){var e=generateHeight(worldWidth,worldDepth);camera.position.y=10*e[worldHalfWidth+worldHalfDepth*worldWidth]+500;var o=new THREE.PlaneBufferGeometry(12500,12500,worldWidth-1,worldDepth-1);o.rotateX(-Math.PI/2);for(var n=o.attributes.position.array,t=0,a=0,r=n.length;t<r;t++,a+=3)n[a+1]=10*e[t]-750;(i=new THREE.CanvasTexture(generateTexture(e,worldWidth,worldDepth))).wrapS=THREE.ClampToEdgeWrapping,i.wrapT=THREE.ClampToEdgeWrapping;var i=(new THREE.TextureLoader).load("/src/images/rock1.png",function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping}),d=new THREE.MeshBasicMaterial({map:i});mesh=new THREE.Mesh(o,d),scene.add(mesh)}function generateHeight(e,o){for(var n=e*o,t=new Uint8Array(n),a=new THREE.ImprovedNoise,r=1,i=100*Math.random(),d=0;d<4;d++){for(var l=0;l<n;l++){var c=l%e,s=~~(l/e);t[l]+=Math.abs(a.noise(c/r,s/r,i)*r*1.75)}r*=5}return t}function generateTexture(e,o,n){var t,a,r,i,d,l,c,s;l=new THREE.Vector3(0,0,0),(c=new THREE.Vector3(1,1,1)).normalize(),(t=document.createElement("canvas")).width=o,t.height=n,(r=t.getContext("2d")).fillStyle="#000",r.fillRect(0,0,o,n);for(var u=0,w=0,h=(d=(i=r.getImageData(0,0,t.width,t.height)).data).length;u<h;u+=4,w++)l.x=e[w-2]-e[w+2],l.y=2,l.z=e[w-2*o]-e[w+2*o],l.normalize(),s=l.dot(c),d[u]=(96+128*s)*(.5+.007*e[w]),d[u+1]=(32+96*s)*(.5+.007*e[w]),d[u+2]=96*s*(.5+.007*e[w]);r.putImageData(i,0,0),(a=document.createElement("canvas")).width=4*o,a.height=4*n,(r=a.getContext("2d")).scale(4,4),r.drawImage(t,0,0);for(u=0,h=(d=(i=r.getImageData(0,0,a.width,a.height)).data).length;u<h;u+=4){var m=~~(5*Math.random());d[u]+=m,d[u+1]+=m,d[u+2]+=m}return r.putImageData(i,0,0),a}function Sky_Waterinit(){var e=new THREE.PlaneGeometry(1e4,1e4);(water=new THREE.Water(e,{textureWidth:512,textureHeight:512,waterNormals:(new THREE.TextureLoader).load("src/images/Water_2_M_Normal.jpg",function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping}),alpha:1,time:0,sunDirection:light.position.clone().normalize(),sunColor:131586,waterColor:0,distortionScale:5})).rotation.x=-Math.PI/2,scene.add(water);var n=new THREE.Sky;(i=n.material.uniforms).turbidity.value=10,i.rayleigh.value=2,i.luminance.value=1,i.mieCoefficient.value=.005,i.mieDirectionalG.value=.8;var t={distance:400,inclination:.49,azimuth:.205},a=new THREE.CubeCamera(.1,1,512);function o(){var e=Math.PI*(t.inclination-.5),o=2*Math.PI*(t.azimuth-.5);light.position.x=t.distance*Math.cos(o),light.position.y=t.distance*Math.sin(o)*Math.sin(e),light.position.z=t.distance*Math.sin(o)*Math.cos(e),n.material.uniforms.sunPosition.value=light.position.copy(light.position),water.material.uniforms.sunDirection.value.copy(light.position).normalize(),a.update(renderer,n)}a.renderTarget.texture.generateMipmaps=!0,a.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.background=a.renderTarget,o(),(r=gui.addFolder("Sky")).add(t,"inclination",0,.5,1e-4).onChange(o).name("Inclination"),r.add(t,"azimuth",0,1,1e-4).onChange(o).name("Azimuth");var r,i=water.material.uniforms;(r=gui.addFolder("Water")).add(i.distortionScale,"value",0,50,1).name("Scale"),r.add(i.alpha,"value",1,10,.1).name("Size"),r.add(i.time,"value",1,1e3,1).name("Time"),r.addColor(i.sunColor,"value").name("Suncolor"),r.addColor(i.waterColor,"value").name("WaterColor")}function Blackcloudinit(e){for(var o=(new THREE.TextureLoader).load("/src/images/cloud_black.png"),n=new THREE.PlaneGeometry(700,700),t=new THREE.MeshBasicMaterial({transparent:GuiControl.cloudtransparent_b,opacity:GuiControl.cloudopacity_b,color:GuiControl.cloudcolor_b,map:o,depthTest:!1}),a=0;a<100;a++)(cloud_b=new THREE.Mesh(n,t)).position.set(1e3*Math.random()*e,500,-1e3*Math.random()*e),cloud_b.rotation.x,Math.random(),cloud_b.rotation.y,Math.random(),cloud_b.rotation.z,Math.random(),cloudparticles_b.add(cloud_b);scene.add(cloudparticles_b)}function Whitecloudinit(e){for(var o=(new THREE.TextureLoader).load("/src/images/cloud_white.png"),n=new THREE.PlaneGeometry(500,500),t=new THREE.MeshBasicMaterial({transparent:GuiControl.cloudtransparent_w,opacity:GuiControl.cloudopacity_w,color:GuiControl.cloudcolor_w,map:o,depthTest:!1}),a=0;a<100;a++)(cloud_w=new THREE.Mesh(n,t)).position.set(-1e3*Math.random()*e,500,1e3*Math.random()*e),cloud_w.rotation.x,Math.random(),cloud_b.rotation.y,Math.random(),cloud_b.rotation.z,Math.random(),cloudparticles_w.add(cloud_w);scene.add(cloudparticles_w)}function Raininit(e){for(var o=(new THREE.TextureLoader).load("/src/images/rain.png"),n=new THREE.Geometry(500,500),t=new THREE.PointsMaterial({size:GuiControl.rainsize,transparent:GuiControl.raintransparent,opacity:GuiControl.rainopacity,vertexColors:GuiControl.rainvertexcolors,sizeAttenuation:GuiControl.rainsizeattenuation,color:GuiControl.raincolor,map:o,depthTest:!1}),a=0;a<15e3;a++){var r=new THREE.Vector3(Math.random()*e-e/2,Math.random()*e-e/2,Math.random()*e-e/2);r.velocityY=.1+Math.random()/5,r.velocityX=(Math.random()-.5)/3,r.velocityZ=(Math.random()-.5)/3,n.vertices.push(r);var i=new THREE.Color(16777215);n.colors.push(i)}(rain=new THREE.Points(n,t)).verticesNeedUpdate=!0,scene.add(rain)}function Snowinit(e){for(var o=(new THREE.TextureLoader).load("/src/images/snowflake7_alpha.png"),n=new THREE.Geometry(500,500),t=new THREE.PointsMaterial({size:GuiControl.snowsize,transparent:GuiControl.snowtransparent,opacity:GuiControl.snowopacity,vertexColors:GuiControl.snowvertexcolors,sizeAttenuation:GuiControl.snowsizeattenuation,color:GuiControl.snowcolor,map:o,depthTest:!1}),a=0;a<15e3;a++){var r=new THREE.Vector3(Math.random()*e-e/2,Math.random()*e-e/2,Math.random()*e-e/2);r.velocityY=.1+Math.random()/5,r.velocityX=(Math.random()-.5)/3,r.velocityZ=(Math.random()-.5)/3,n.vertices.push(r);var i=new THREE.Color(16777215);n.colors.push(i)}(snow=new THREE.Points(n,t)).verticesNeedUpdate=!0,scene.add(snow)}MUSICTIMEBAB(GuiControl.christmastimebab,sound_1),MUSICTIMEBAB(GuiControl.chickentoobeauty,sound_2),MUSICTIMEBAB(GuiControl.GETHIGHB,sound_3),(folder=gui.addFolder("Event")).add(GuiControl,"rotatesystem").onChange(redraw_ec).name("Autoroate"),folder.add(GuiControl,"sound_1v",0,1,.01).onChange(function(){sound_1.setVolume(GuiControl.sound_1v),sound_1.play()}).name("Chirstmas Time!"),folder.add(GuiControl,"sound_2v",0,1,.01).onChange(function(){sound_2.setVolume(GuiControl.sound_2v),sound_2.play()}).name("BeautyChicken"),folder.add(GuiControl,"sound_3v",0,1,.01).onChange(function(){sound_3.setVolume(GuiControl.sound_3v),sound_3.play()}).name("GET HIGH"),(folder=gui.addFolder("Wind")).add(GuiControl,"windpower_x",0,5,.1).onChange(redraw_ec).name("Wind-X"),folder.add(GuiControl,"windpower_z",0,5,.1).onChange(redraw_ec).name("Wind-Z"),(folder=gui.addFolder("Rain")).add(GuiControl,"rainrange",100,5e3).onChange(redraw_ec).name("Range"),folder.add(GuiControl,"rainsize",.1,20).onChange(redraw_ec).name("Size"),folder.add(GuiControl,"rainopacity",0,1).onChange(redraw_ec).name("Opacity"),folder.addColor(GuiControl,"raincolor").onChange(redraw_ec).name("Color"),folder.add(GuiControl,"raintransparent").onChange(redraw_ec).name("Transparent"),folder.add(GuiControl,"rainvertexcolors").onChange(redraw_ec).name("Texcolor"),folder.add(GuiControl,"rainsizeattenuation").onChange(redraw_ec).name("Attenuation"),(folder=gui.addFolder("Snow")).add(GuiControl,"snowrange",100,5e3).onChange(redraw_ec).name("Range"),folder.add(GuiControl,"snowsize",.1,20).onChange(redraw_ec).name("Size"),folder.add(GuiControl,"snowopacity",0,1).onChange(redraw_ec).name("Opacity"),folder.addColor(GuiControl,"snowcolor").onChange(redraw_ec).name("Color"),folder.add(GuiControl,"snowtransparent").onChange(redraw_ec).name("Transparent"),folder.add(GuiControl,"snowvertexcolors").onChange(redraw_ec).name("Texcolor"),folder.add(GuiControl,"snowsizeattenuation").onChange(redraw_ec).name("Attenuation"),(folder=gui.addFolder("BlackCloud")).add(GuiControl,"blackcloudrange",1,10).onChange(redrwa_bc).name("Range"),folder.add(GuiControl,"cloudsize_b",.1,10).onChange(redrwa_bc).name("Size"),folder.add(GuiControl,"cloudopacity_b",0,1).onChange(redrwa_bc).name("Opacity"),folder.addColor(GuiControl,"cloudcolor_b").onChange(redrwa_bc).name("Color"),folder.add(GuiControl,"cloudtransparent_b").onChange(redrwa_bc).name("Transparent"),(folder=gui.addFolder("WhiteCloud")).add(GuiControl,"whitecloudrange",1,10).onChange(redrwa_wc).name("Range"),folder.add(GuiControl,"cloudsize_w",.1,10).onChange(redrwa_wc).name("Size"),folder.add(GuiControl,"cloudopacity_w",0,1).onChange(redrwa_wc).name("Opacity"),folder.addColor(GuiControl,"cloudcolor_w").onChange(redrwa_wc).name("Color"),folder.add(GuiControl,"cloudtransparent_w").onChange(redrwa_wc).name("Transparent"),(stats=new Stats).domElement.style.position="absolute",stats.domElement.style.left="0px",container.appendChild(stats.dom),window.addEventListener("resize",onWindowResize,!1),Terraininit(),Sky_Waterinit(),Blackcloudinit(GuiControl.blackcloudrange),Whitecloudinit(GuiControl.whitecloudrange),Raininit(GuiControl.rainrange),Snowinit(GuiControl.snowrange),animate()</script> <script type="text/javascript" src="main.js"></script></body> </html> 